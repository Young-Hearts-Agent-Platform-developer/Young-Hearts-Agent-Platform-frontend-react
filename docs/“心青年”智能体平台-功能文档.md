# “心青年”智能体平台 功能文档

## 版本记录
| 日期 | 修改类型 | 修改摘要 |
|---|---|---|
| 2025-12-27 | 新建 | 初始版本创建（MVP 聚焦基础检索与工单） |
| 2026-01-11 | 更新 | **核心重构**：<br>1. 将 RAG（检索增强生成）提升为第一阶段核心咨询引擎；<br>2. 架构调整：将知识录入、志愿者管理等后台功能整合为模块化的“统一服务中心”。 |
| 2026-01-11 | 更新 | 补充志愿者全流程管理：招募、排班、服务记录、服务状态与联系方式。 |
| 2026-01-11 | 更新 | 补充知识库录入两方案：初期人工录入表单与后期自动化解析/切片管道。 |
| 2026-01-11 | 更新 | **RBAC 体系细化**：<br>1. 明确患者家属、志愿者、专家、管理员、维护人员五大角色职责；<br>2. 重构子模块 C（系统管理），细化权限矩阵；<br>3. 调整知识库与志愿者模块以适配新角色流程。 |
| 2026-01-11 | 更新 | **志愿者任务体系升级**：<br>1. 明确“线下志愿活动”与“线上咨询工单”双任务流；<br>2. 增加线下班次报名、审核、替班/请假及邮件提醒流程；<br>3. 增加线上工单“主动认领（需审核）”机制。 |
| 2026-01-11 | 更新 | **专家功能增强**：<br>1. 新增专家协同模块（注册审核）；<br>2. 赋予专家查看与接取咨询工单的权限；<br>3. 强化专家在知识库审核中的核心地位。 |
| 2026-01-11 | 更新 | **隐私与信息公开机制优化**：<br>1. 区分手机号（Admin可见）与邮箱（对外可见）；<br>2. 新增“专家/志愿者信息展示”子模块，供家属查询已认证且愿意公开的人员信息。 |
| 2026-01-11 | 更新 | **知识库功能细分**：<br>1. 拆分为“知识贡献”（仅内部）与“可视化查阅”（全员开放）两部分；<br>2. 明确家属可主动查询知识库资料。 |

## 文档日期
2026-01-11

## 项目目的
构建一个基于**RAG（检索增强生成）技术**的专业咨询平台，旨在解决孤独症家庭面临的“专业知识获取难”与“个性化建议匮乏”问题。
平台核心目标：
1. **智能咨询（核心）**：通过大模型与专业知识库结合，提供7x24小时、有权威依据的问答服务。
2. **统一服务（支撑）**：将分散的运营功能（知识录入、志愿者协作）模块化，形成一站式服务中心，降低维护门槛。

## 目标用户与角色
- **患者家属（核心用户）**：使用 RAG 智能咨询获取建议；当 AI 无法解决时发布人工咨询工单。
- **志愿者**：负责上传知识库作为草稿；在任务看板认领或接收管理员指派的工单进行解答。
- **专家**：负责知识库的高质量内容产出与审核（把关人）；主动接取或处理疑难咨询工单；在紧急情况下提供专业支持。
- **管理员**：负责志愿者及专家的人员准入（注册审核）与任务的宏观调度。
- **维护人员**：负责系统后台记录审查与技术运维。

---

## 功能阶段规划表

| 阶段 | 功能模块 | 优先级 | 研发复杂度 |
|---|---|---|---|
| **第一阶段 (MVP)** | **RAG 智能咨询引擎（知识库问答）** | **P0** | **高** |
| **第一阶段 (MVP)** | **统一服务中心（模块化工作台）** | **P0** | 中 |
| 第一阶段 (MVP) | 基础用户认证与鉴权 | P1 | 低 |
| 第二阶段 | 用户/患者画像与个性化记忆 | P1 | 中 |
| 第三阶段 | 多模态交互（语音/视频情绪识别） | P2 | 高 |

---

## 第一阶段功能详情（核心交付）

### 1. RAG 智能咨询引擎（核心功能）
**需求概述**：
改变传统的关键词搜索模式，利用向量检索（Vector Search）配合 LLM，理解用户模糊、口语化的提问，基于专业知识库生成准确、有同理心的回答，并严格标注来源。

**用户场景 (User Story)**：
> 家长在深夜遇到孩子突发刻板行为，焦虑地输入一段长语音转换的文字：“孩子一直撞墙如果不让他撞他就尖叫怎么办？”
> 系统利用 RAG 技术，检索知识库中关于“自伤行为”与“刻板行为阻断”的专业条目，生成一份包含“即时安全干预”、“情绪安抚话术”和“后续就医标准”的结构化建议，并附带引用的专家文章链接。

**验收标准**：
1. **准确性**：基于测试集的回答，专业人员认可度 ≥ 85%，且无严重幻觉（胡乱编造医疗建议）。
2. **可溯源**：所有回答必须在末尾附带参考的知识库文档名称或链接（“来源：XXX康复指南 第3章”）。
3. **响应速度**：从提问到开始生成回答（TTFT）不超过 5 秒。
4. **兜底机制**：当知识库无相关内容时，明确告知“暂无准确参考”，引导转人工/志愿者。

**技术/数据依赖**：
- 向量数据库（Milvus/Chroma/PGVector）。
- 嵌入模型（Embedding Model）与生成模型（LLM）。
- 经过清洗和切片的专业文档库（Markdown/PDF）。

---

### 2. 统一服务中心（模块化收纳）
**需求概述**：
摒弃散乱的后台页面，构建一个统一的“服务中心”入口。用户（管理员/志愿者/专家）登录后，根据权限展示不同的功能“卡片”或“模块”。

#### 子模块 A：知识库管理模块

本模块分为**知识贡献（录入）**与**知识查阅（可视化）**两部分，针对不同角色开放不同权限。

##### 第一部分：知识贡献（为知识库添加新条目）
- **权限**：志愿者、专家、管理员。
- **目标**：丰富专业康复知识，支持 RAG 引擎的精准回答。
- **实现方案**：保留“初期手动”与“后期自动化”两套方案并行。

方案 1 — 初期（手动录入/冷启动）
- **需求概述**：提供前端表单界面，运营/专家通过表单人工录入或粘贴文档片段，并手动将内容分割为结构化条目。
- **用户场景**：**志愿者**整理了一篇康复文章，通过“上传材料”填写入库申请，状态为“待审核”；**专家**登录后台，查看“待审核”列表，校验内容准确性后点击“通过”，内容正式进入检索库。
- **验收标准**：
  1. 前端表单支持必填字段（标题, 摘要, 步骤, 标签）录入。
  2. 提交内容默认进入“待审核”队列，RAG 引擎不可见。
  3. 专家审核通过后，数据状态变更为“已发布”。
- **依赖项**：表单 UI、审核流状态机。
- **估算工时**：S（小）。

方案 2 — 后期（自动化管道）
- **需求概述**：用户上传原始文档（PDF/Word），系统自动解析、切片与向量化，并提供人工校正界面。
- **用户场景**：**专家**上传一份 30 页指南，系统自动切片，专家在“切片编辑”界面校正后发布。
- **验收标准**：
  1. 后台任务实现文档转向量索引的全流程。
  2. 提供“切片预览与编辑”界面，允许专家在入库前干预。
- **依赖项**：OCR、解析器、向量数据库、任务队列。
- **估算工时**：L（大）。

-- **安全与合规**：所有上传文档需进行 PII 敏感检测，必要时脱敏。

##### 第二部分：知识库可视化查阅（主动查询）
- **权限**：**全员开放**（包含患者家属）。
- **需求概述**：除了被动接收 RAG 的回答，用户还可主动浏览和检索知识库中的已发布内容。提供类似“Wiki”或“文档中心”的可视化界面。
- **功能特性**：
  - **分类导航**：按标签（如“情绪干预”、“生活自理”）展示知识条目。
  - **全文检索**：支持关键词搜索，直接返回相关文档或条目列表。
  - **详情阅读**：点击条目查看完整内容、来源及专家点评（如有）。
- **用户场景**：家属不确定如何提问，直接点击“康复资料库”，浏览“家庭干预”分类下的文章学习。
- **验收标准**：
  1. 家属端增加“资料库”入口，仅展示状态为“已发布”的条目。
  2. 搜索响应时间 < 1秒（基于关键词索引）。
- **估算工时**：S（小） — 复用检索接口，主要工作在前端展示页。

#### 子模块 B：志愿者管理模块
- **功能**：
  - **招募与审核**：志愿者注册需填写详细资料（含联系方式），提交后状态为“待审核”。**管理员**负责审核注册请求。
  - **服务状态管理**：
    - **在线**：进入工作状态，可以接受任务。
    - **忙碌**：手中已有任务，系统不再派发新任务。
    - **离线**：不在服务时间内。
    - **待审核**：注册未通过，权限受限。
  - **任务类型 A：线下志愿活动**：
    - **班次管理**：管理员创建线下活动班次（时间、地点、人数上限）。
    - **报名与分配**：志愿者可查看班次并主动报名（提交申请 -> 管理员审核 -> 成功报名），或由管理员直接指派。
    - **变更与考勤**：支持志愿者提交替班或请假申请；系统在活动开始前发送自动邮件提醒。
  - **任务类型 B：线上咨询工单**：
    - **来源**：由患者家属发布，或 RAG 无法回答时自动生成。
    - **接单与分配**：志愿者在工单池主动申请接单（需管理员审核），或由管理员强制分配。配对成功后系统发送提醒。
  - **服务记录与报表**：统一记录线上与线下的服务时长、服务内容与反馈评分，支持导出报表。
  - **个人资料与已公开信息**：
    - 志愿者可维护个人简介、擅长领域。
    - **隐私控制**：手机号强制仅管理员可见；邮箱只要填写且设置了公开，则在“志愿者信息列表”中展示。若未设置公开，则该志愿者不会出现在志愿者墙中。

- **验收标准**：
  1. **状态机严格**：“待审核”状态无法报名任何活动；“离线”状态不可被指派即时工单（但可报名未来线下班次）。
  2. **线下流程**：志愿者报名后，后台显示“待审批”；管理员通过后，志愿者收到确认邮件；活动前24小时再次触发邮件提醒。
  3. **线上流程**：志愿者申请接单后，管理员后台可见申请列表；审核通过后，工单状态变更为“处理中”并绑定该志愿者。
  4. **数据导出**：导出的 CSV 需区分“活动类型”（线上/线下）与具体服务时长。
  5. **隐私验证**：家属端查看到的志愿者信息卡片中，手机号不可见；只有设置了公开的邮箱才展示，未公开则该志愿者不会出现在志愿者墙。

- **依赖项**：
  - 邮件服务（SMTP/SendGrid）用于活动提醒。
  - 用户表扩展字段（public_email, is_public_visible）。
  - 审批工作流（用于报名与接单）。

- **估算工时**：M（中等） — 增加了班次管理与审批流，逻辑复杂度提升。

#### 子模块 C：专家协同与管理模块
- **功能**：
  - **专家注册与审核**：专家填写职业资质、执业证书与擅长领域，提交后状态为“待审核”。**管理员**负责审核其资质。
  - **知识库审核台**：
    - 展示所有由志愿者或专家提交的“待审核”知识条目（含切片）。
    - 提供“通过”、“驳回（附带修改意见）”及“直接编辑并发布”的操作界面。
  - **专家咨询工作台**：
    - **工单池**：专家可查看所有“待处理”的线上咨询工单，支持按标签（如“自伤行为”、“用药咨询”）筛选。
    - **主动接单**：专家可点击“接取”按钮，工单直接流转至该专家名下（无需管理员二次审核），状态变更为“专家处理中”。
  - **个人资料管理**：维护个人简介、紧急联系方式及可对外公开的专业背景信息。
    - **联系方式**：系统区分“管理用手机号”（仅管理员可见）与“对外邮箱”（可公开）。专家如未设置“对外公开”，则不会出现在专家墙中；如设置公开且填写邮箱，则在专家墙展示邮箱。

- **验收标准**：
  1. **注册流**：专家注册必须上传资质证明附件，否则无法提交；审核通过前无法进入工作台。
  2. **工单流**：专家接单具有最高优先级，可直接接取志愿者已认领但未开始处理的工单（需提示确认）。
  3. **审核流**：专家驳回的知识条目，原提交者（志愿者）能收到通知并查看修改意见。
  4. **信息展示**：专家在个人中心开启“公开信息”后，且填写了邮箱，其专家卡片在“专家墙”上显示该邮箱链接，否则不出现在专家墙。

- **依赖项**：
  - 用户表（User Table）新增 Expert 角色及 profile 扩展表。
  - 工单状态机新增“专家处理中”状态。

- **估算工时**：M（中） — 主要是前端审核界面的交互逻辑与权限控制。

#### 子模块 D：人员信息公开模块（面向家属）
- **需求概述**：
  为增强平台信任度与家属的安全感，建立一个受控的“专家/志愿者墙”，展示已认证且愿意公开信息的人员。

- **功能**：
  - **专家列表**：仅展示`is_verified=true`且`is_public_visible=true`且邮箱已填写的专家，显示头像、昵称、认证资质、擅长领域与邮箱。
  - **志愿者列表**：仅展示`is_verified=true`且`is_public_visible=true`且邮箱已填写的志愿者，显示头像、昵称、服务时长与邮箱。
  - **隐私过滤**：所有人员的**手机号**在此模块严格隐藏；仅状态为“正常/在线/离线”的人员可展示，“待审核”或“封禁”人员不展示。

- **用户场景**：
  > 家属希望找一位擅长“大龄自闭症就业指导”的专家咨询，点击“找专家”模块，浏览专家简介，通过公开的邮箱发送了初步问询，随后在平台上发布了指定该专家的工单（若流程支持）。

- **验收标准**：
  1. 列表仅能筛选出`is_verified=true`且`is_public_visible=true`且邮箱已填写的人员。
  2. 点击人员卡片，详情页中不得包含 mobile 字段。
  3. 邮箱字段若为空或未公开，前端应展示“未公开”或不展示该行。

- **估算工时**：S（小） — 主要是只读接口与前端列表页。

#### 子模块 E：系统管理与权限控制模块
- **需求概述**：
  构建精细化的 RBAC（基于角色的访问控制）模型，确保不同角色（患者家属、志愿者、专家、管理员、维护人员）仅能访问其职责范围内的资源。

- **角色权限矩阵**：

| 角色 | 核心权限描述 | 数据访问范围 |
|---|---|---|
| **患者家属** | 1. 使用 RAG 问答<br>2. 提交咨询工单<br>3. 查看本人咨询工单历史 | 仅限本人数据 |
| **志愿者** | 1. **知识库**：上传材料（仅提交，不可审核）<br>2. **个人**：注册/完善资料（含联系方式），切换服务状态（在线/忙碌/离线）<br>3. **任务**：查看任务看板，主动认领或被指派任务 | 自己的任务与资料<br>仅限所认领任务的详情 |
| **专家** | 1. **知识库**：上传材料、**审核**他人提交的材料（通过/驳回）<br>2. **任务**：查看工单池，**无需审核**直接接取疑难工单<br>3. **个人**：注册资质认证、完善个人资料 | 知识库全量数据<br>全量咨询工单（用于筛选疑难杂症） |
| **管理员** | 1. **人员**：审核志愿者/专家注册，查看全员详情<br>2. **任务**：向“在线”志愿者强制派单<br>3. **统计**：查看全平台运营记录 | 全平台用户与业务数据 |
| **维护人员** | 1. **运维**：查看后端程序日志（Error/Access Log）<br>2. **监控**：系统运行健康度监控 | 系统日志与性能指标<br>无权查看用户敏感隐私 |

- **验收标准**：
  1. **菜单隔离**：志愿者登录看不到“知识库审核”入口；家属登录无后台入口。
  2. **按钮级控制**：志愿者上传材料页面无“发布”按钮，只有“提交审核”按钮。
  3. **数据安全**：维护人员查看日志时，日志中的用户手机号/姓名应通过中间件自动脱敏（如 `138****0000`）。
  4. **流程验证**：
     - 家属提工单 -> 志愿者（在线）在看板看到 -> 认领 -> 完结。
     - 志愿者注册 -> 管理员审核通过 -> 志愿者状态变更为“离线”（可切换为在线）。

- **估算工时**：M（中） — 涉及后端权限中间件（Middleware）、角色鉴权守卫（Guard）及前端动态路由设计。

---

## 风险与缓解

| 风险描述 | 影响范围 | 缓解建议 |
|---|---|---|
| **RAG 幻觉风险** | 智能咨询 | 1. 调整 Prompt 严格限制基于上下文回答；<br>2. 设置置信度阈值，低分回答强制转人工或显示警告；<br>3. 并在UI显著位置标注“AI建议仅供参考，医疗决策请遵医嘱”。 |
| **知识库质量参差** | RAG 效果 | 这里的瓶颈通常不在技术而在数据。需建立严格的“知识录入-审核-发布”流程，确保进入向量库的数据是干净且权威的。 |
| **算力成本** | 项目预算 | 初期使用轻量级开源模型或按 Token 计费的商业 API，避免部署昂贵的私有化大模型集群。 |

## 待用户确认的问题
1. **数据源现状**：目前手头是否有现成的、结构化的 PDF/Word 文档作为知识库冷启动数据？（决定了 RAG 的初期效果）。
2. **志愿者流程**：志愿者介入是仅限于“回答问题”，还是需要具备“线下支援”的能力？（影响管理模块的字段设计）。
3. **合规性**：医疗类建议的免责声明具体措辞是否需要法务审核？

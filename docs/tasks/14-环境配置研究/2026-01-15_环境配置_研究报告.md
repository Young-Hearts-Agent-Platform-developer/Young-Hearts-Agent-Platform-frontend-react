# 环境配置 研究报告

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-15 | v1.0 | 初始设计 | 无 |

## 研究问题

目前项目的“环境”是怎么配置的？

## 发现摘要

- 项目采用 Vite 作为前端构建工具，环境变量通过 `.env` 文件和 `import.meta.env` 机制注入。
- 主要环境变量以 `VITE_` 前缀命名，支持自定义和 Vite 内置变量（如 `MODE`、`DEV`）。
- 代码中通过 `import.meta.env` 访问环境变量，区分开发/生产环境。
- Vite 配置文件（`vite.config.js`）可设置 dev server 端口、host 等参数。
- 依赖包和脚本在 `package.json` 中定义，支持 `dev`、`build`、`preview` 等命令。

## 相关文件清单

|文件路径|作用说明|关键行号|
|---|---|---|
|.env|定义环境变量（如 VITE_MODE）|L1|
|vite.config.js|Vite 构建与开发服务器配置|L1-L12|
|src/App.jsx|打印和使用环境变量的示例|L13-L28|
|src/api/auth.js|根据环境变量切换 mock/真实 API|L78-L110|
|package.json|依赖与脚本定义|L1-L40|

## 当前实现分析

### 环境变量注入与使用
- `.env` 文件用于定义如 `VITE_MODE=development` 的变量。
- 通过 `import.meta.env` 访问所有环境变量，包括：
  - `VITE_` 前缀的自定义变量（如 `VITE_APP_TITLE`, `VITE_API_BASE_URL`）。
  - Vite 内置变量（如 `MODE`, `DEV`）。
- 代码示例（src/App.jsx）：
  - `console.log('📝 所有环境变量：', import.meta.env);`
  - `console.log('🔧 当前环境模式：', import.meta.env.MODE);`
- API 层（src/api/auth.js）通过 `import.meta.env.MODE` 判断是否为开发环境，决定是否使用 mock 数据。

### Vite 配置
- `vite.config.js` 通过 `defineConfig` 配置插件、host、端口等。
- 端口默认 5173，host 设为 `0.0.0.0` 以便局域网访问。

### 依赖与脚本
- `package.json` 定义了依赖包和常用脚本（dev/build/lint/preview）。

### 核心流程

```
[.env] → [Vite 启动/构建] → [import.meta.env 注入变量] → [代码中读取/判断环境] → [API/mock/配置切换]
```

### 关键代码片段

- src/App.jsx
  ```js
  useEffect(() => {
    console.log('📝 所有环境变量：', import.meta.env);
    console.log('🔧 当前环境模式：', import.meta.env.MODE);
    console.log('🔧 是否为开发环境：', import.meta.env.DEV);
  }, []);
  ```
- src/api/auth.js
  ```js
  if (import.meta.env.MODE === 'development') {
    // mock 逻辑
  }
  ```
- vite.config.js
  ```js
  export default defineConfig({
    plugins: [react()],
    server: {
      host: '0.0.0.0',
      port: 5173
    }
  })
  ```

## 架构洞察

- Vite 的环境变量机制天然支持多环境切换，推荐所有自定义变量加 `VITE_` 前缀。
- 通过 `import.meta.env.MODE` 可灵活区分开发/生产逻辑，便于 mock/真实 API 切换。
- 端口、host 等本地开发参数集中在 `vite.config.js`，易于维护。

## 潜在风险和边缘情况

- `.env` 文件未提交或变量缺失时，相关功能可能异常。
- 生产环境如未正确覆盖 `.env`，可能导致 mock 数据泄漏。
- 仅支持 Vite 机制，迁移到其他构建工具需调整变量注入方式。

## 开放问题

- 是否有多套 `.env` 文件（如 `.env.production`）？
- 生产部署时环境变量如何覆盖和管理？
- 是否有自动化校验环境变量完整性的机制？

## 参考资料

- [Vite 官方文档：环境变量与模式](https://cn.vitejs.dev/guide/env-and-mode.html)
- [Vite 配置参考](https://cn.vitejs.dev/config/)


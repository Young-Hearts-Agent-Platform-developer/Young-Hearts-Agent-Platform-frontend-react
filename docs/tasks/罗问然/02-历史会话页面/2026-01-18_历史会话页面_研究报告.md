# 历史会话页面 研究报告

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-18 | v1.0 | 初始研究报告 | 新页面开发需求 |

## 研究问题

按照新的设计方案，制作历史会话页面（使用 SubLayout，右侧为“新对话”入口，点击后创建新的会话）

## 发现摘要

- 历史会话页面尚未实现，需新建 `src/pages/consultation/history.jsx`。
- 需采用 `SubLayout` 作为页面布局，顶部标题为“历史会话”，右侧为“新对话”按钮。
- “新对话”按钮点击后应调用新会话创建逻辑，跳转到 `/consultation/chat/:sessionId`。
- 需展示当前用户的历史会话列表，支持点击进入对应会话。
- 相关 API、状态管理与会话数据结构需进一步梳理。

## 相关文件清单

|文件路径|作用说明|关键行号|
|---|---|---|
|src/pages/consultation/history.jsx|历史会话页面（待新建）|全文件|
|src/layouts/SubLayout.jsx|通用次级页面布局|全文件|
|src/components/Header/index.jsx|头部组件，支持右侧操作|全文件|
|src/components/IconActionButton/index.jsx|通用图标按钮，可用于右侧操作|全文件|

## 当前实现分析

- 目前 `src/pages/consultation/` 目录为空，历史会话页面未实现。
- `SubLayout` 支持 `rightActions` 属性，可自定义右侧操作按钮。
- `Header` 组件基于 Ant Design Mobile `NavBar`，支持 `right` 区域自定义。
- 暂无会话相关 API、状态管理或数据结构实现，需后续补充。

### 核心流程

1. 用户从首页点击“智能体咨询”进入历史会话页面。
2. 页面通过 `SubLayout` 渲染，顶部标题为“历史会话”，右侧为“新对话”按钮。
3. 页面加载当前用户历史会话列表，支持点击进入会话详情。
4. 点击“新对话”按钮，调用新会话创建逻辑，跳转到 `/consultation/chat/:sessionId`。

### 关键代码片段

```jsx
// SubLayout 用法示例
<SubLayout
  title="历史会话"
  rightActions={[
    <IconActionButton icon={<PlusIcon />} ariaLabel="新对话" onClick={handleNewSession} />
  ]}
>
  {/* 会话列表渲染 */}
</SubLayout>
```

## 架构洞察

- 推荐将会话列表与新建会话逻辑解耦，便于后续复用。
- 可考虑将“新对话”按钮抽象为通用组件，便于其他页面复用。
- 需明确会话数据获取方式（API/本地缓存/全局状态）。

## 潜在风险和边缘情况

- 会话数据接口未定义，需与后端对齐。
- 新建会话后跳转逻辑需确保 sessionId 有效。
- 空列表、加载中、异常等状态需处理。

## 开放问题

- 会话数据结构与 API 细节？     回答：参考 `docs\“心青年”智能体平台-数据模型与 API 设计.md`。
- 新建会话接口/流程？           回答：调用 `/api/consult/sessions` (post) 创建新会话。
- 会话列表获取方式？             回答：调用 `/api/consult/sessions` (get) 获取当前用户会话列表。
- 权限与鉴权逻辑？              回答：仅登录用户可访问。

## 参考资料

- docs/“心青年”智能体平台-前端界面设计方案.md
- src/layouts/SubLayout.jsx
- src/components/Header/index.jsx


# API修正与参数对齐 实现计划

## 版本记录

| 日期       | 版本 | 修改内容           | 修改原因                 |
|------------|------|--------------------|--------------------------|
| 2026-01-17 | v1.0 | 初始计划           | 基于研究报告与用户澄清   |

## 关联研究
docs/tasks/罗问然/19-API修正与参数对齐/2026-01-17_API修正与参数对齐_研究报告.md

## 功能概述
对齐前端 API 实现与 openapi.json，修正 updateUserProfile 路径与参数，清理 login Mock 逻辑，Mock 用户数据字段与 OpenAPI 对齐，生成类型定义文件，所有前端独有字段需保留并标注来源。

---

## Phase 1: 修正 updateUserProfile API

### 目标
- 路径改为 `/api/auth/me`
- 方法为 PUT
- 参数结构严格对齐 OpenAPI UserUpdate schema

### 修改文件清单

|文件路径|修改类型|说明|
|---|---|---|
|src/api/auth.js|更新|修正 updateUserProfile 实现|

### 具体变更
- 修改 updateUserProfile 的 URL、method、参数结构
- 移除/调整与 OpenAPI 不符的参数

### 成功标准
- 自动验证：调用 updateUserProfile 时请求路径、方法、参数与 openapi.json 一致
- 手动验证：联调后端可正常更新用户信息

---

## Phase 2: 清理 login Mock 逻辑

### 目标
- 移除 login 函数中重复、混乱的 Mock 判断
- 统一使用 import.meta.env.VITE_MODE 进行环境判断

### 修改文件清单

|文件路径|修改类型|说明|
|---|---|---|
|src/api/auth.js|更新|清理 login Mock 逻辑|

### 具体变更
- 保留一套 Mock 判断逻辑，移除冗余分支

### 成功标准
- 自动验证：login 逻辑分支清晰，无重复判断
- 手动验证：Mock/真实环境下登录功能均可用

---

## Phase 3: 对齐 MOCK_USER 字段

### 目标
- Mock 用户数据字段与 OpenAPI 对齐
- 前端独有字段（如 bio、qualifications）保留并注释“前端独有/文档缺失”

### 修改文件清单

|文件路径|修改类型|说明|
|---|---|---|
|src/api/auth.js|更新|修正 MOCK_USER 字段及注释|

### 具体变更
- 字段命名、结构与 OpenAPI 一致
- 独有字段加注释

### 成功标准
- 自动验证：Mock 数据结构与 OpenAPI 一致
- 手动验证：页面展示无 undefined 字段报错，独有字段有注释

---

## Phase 4: 生成类型定义文件

### 目标
- 根据 OpenAPI UserOut/UserUpdate 生成 TypeScript 类型定义
- 保留前端独有字段并注释来源

### 修改文件清单

|文件路径|修改类型|说明|
|---|---|---|
|src/types/User.js|更新|补充/修正类型定义|
|（如需）src/types/User.d.ts|新增|TS 类型声明|

### 具体变更
- 类型字段与 OpenAPI 对齐
- 独有字段加注释

### 成功标准
- 自动验证：类型检查通过
- 手动验证：类型定义与接口一致，独有字段有注释

---

## PR 模板建议

**commit message**:
```
fix(api): 对齐认证相关 API 路径与参数，清理 login Mock 逻辑，修正 Mock 用户数据结构，补充类型定义
```

**PR 描述要点**:
- updateUserProfile 路径与参数对齐 OpenAPI
- login Mock 逻辑统一
- Mock 用户数据字段标准化，独有字段有注释
- 类型定义文件同步更新

---

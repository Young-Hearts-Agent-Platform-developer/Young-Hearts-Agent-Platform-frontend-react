# 会话标题渲染为副标题 实现计划

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-21 | v1.0 | 初始计划 | 基于研究报告与澄清答复 |

## 关联研究
[e:/Project/Web_Development/Young-Hearts-Agent-Platform/Young-Hearts-Agent-Platform-frontend-react/docs/tasks/罗问然/11-会话标题渲染为副标题/2026-01-21_会话标题渲染为副标题_研究报告.md](e:/Project/Web_Development/Young-Hearts-Agent-Platform/Young-Hearts-Agent-Platform-frontend-react/docs/tasks/罗问然/11-会话标题渲染为副标题/2026-01-21_会话标题渲染为副标题_研究报告.md)

## 功能概述
将会话标题（topic）渲染为 chat 页面的副标题。首次进入页面时拉取会话 topic，若失败则副标题显示“加载失败”。若后端 SSE 流式输出的尾包中出现 `[TOPIC]...`，则动态更新副标题。副标题无需多语言适配。

---

## Phase 1: 首次加载会话标题并渲染副标题

### 目标
- 进入 chat 页面时，拉取当前会话 topic，副标题显示 topic 或“新对话”/“加载失败”。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/pages/consultation/chat.jsx|更新|新增 useEffect 拉取 topic，副标题状态管理|
|src/api/consult.js|只读/辅助|复用 getSessions，无需新增接口|
|src/layouts/SubLayout.jsx|只读/辅助|已支持 subtitle 属性，无需修改|

### 具体变更
- 在 chat.jsx 中：
  - 通过 useParams 获取 sessionId，sessionId 来源为 url 参数 `/consultation/chat/:sessionId`。
  - 首次加载时调用 getSessions，查找当前 id 的 topic。
  - 用 useState 管理副标题，兜底“新对话”，失败时为“加载失败”。
  - 将副标题通过 subtitle 传递给 SubLayout。

### 成功标准
- 自动验证：页面加载后副标题正确显示 topic/新对话/加载失败。
- 手动验证：切换不同会话 id，副标题随之变化。

---

## Phase 2: SSE 尾包动态更新副标题

### 目标
- 当 SSE 流式输出的尾包中出现 `[TOPIC]...` 时，自动更新副标题。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/pages/consultation/chat.jsx|更新|监听 SSE 消息，检测并解析 [TOPIC]，更新副标题|

### 具体变更
- 在 chat.jsx 的 SSE 监听逻辑中：
  - 检查每条消息内容，若为 `[TOPIC]xxx`，则 setSubtitle(xxx)。
  - 保证副标题实时响应。

### 成功标准
- 自动验证：模拟 SSE 尾包推送 `[TOPIC]新标题`，副标题自动变更。
- 手动验证：实际对话过程中副标题可被流式更新。

---

## Phase 3: 验证与回归测试

### 目标
- 确保副标题逻辑健壮，边界情况处理完善。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/pages/consultation/chat.jsx|测试/回归|手动/自动化测试|

### 具体变更
- 检查首次加载、接口失败、SSE 更新、会话切换等场景。

### 成功标准
- 自动验证：通过相关单元/集成测试。
- 手动验证：所有场景副标题表现符合预期。

---

## Commit message 模板
feat(chat): 支持会话标题渲染为副标题并流式动态更新

## PR 描述要点
- 首次加载会话 topic 作为副标题，失败时兜底“加载失败”
- SSE 尾包支持 [TOPIC] 动态更新副标题
- 副标题无需国际化，切换会话时仅首次加载
- 完善边界与异常处理

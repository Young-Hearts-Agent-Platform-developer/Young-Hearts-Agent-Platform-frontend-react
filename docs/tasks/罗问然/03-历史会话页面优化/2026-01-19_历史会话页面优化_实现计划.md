# 历史会话页面优化 实现计划

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-19 | v1.0 | 初始计划 | 基于 2026-01-19_历史会话页面优化_研究报告 |

## 关联研究
[docs/tasks/罗问然/03-历史会话页面优化/2026-01-19_历史会话页面优化_研究报告.md](docs/tasks/罗问然/03-历史会话页面优化/2026-01-19_历史会话页面优化_研究报告.md)

## 功能概述
历史会话页面前端实现全面优化，去除冗余兼容分支，统一处理标准化数据结构，提升易用性、扩展性和交互一致性。包括会话列表加载、详情跳转、新建会话、异常与边界状态统一处理等。

---

## Phase 1: 标准化会话列表与详情数据处理

### 目标
- 仅处理后端返回的标准化数据结构，去除冗余兼容分支。
- 会话列表与详情分离，统一 API 对接。

### 修改文件清单

|文件路径|修改类型|说明|
|---|---|---|
|src/pages/consultation/history.jsx|更新|主页面逻辑，统一数据处理|
|src/store/consultSession.jsx|更新|会话列表 API 对接，去除兼容分支|
|src/api/consult.js|重构|参考同目录的 auth.js，更新 api 构造方式|

### 具体变更
- 移除对非标准字段的兼容处理，只处理 `res.sessions`、`session.sessionId` 等标准字段。
- 会话详情仅通过 `/api/consult/sessions/:id` 获取，跳转时传递详情数据。
- 新建会话后仅跳转 sessionId，无需兼容旧结构。
- 重构不符合项目规范的 API 文件，参考 auth.js 进行统一构造。

### 成功标准
- 自动验证：会话列表与详情均能正常加载，且仅依赖标准字段。
- 手动验证：无兼容分支，异常时仅显示统一错误提示。

---

## Phase 2: 统一异常、加载、空列表状态处理

### 目标
- 在 SessionList 组件内统一处理加载中、异常、空列表等状态，提升交互一致性。

### 修改文件清单

|文件路径|修改类型|说明|
|---|---|---|
|src/pages/consultation/history.jsx|更新|异常与边界状态处理逻辑|
|src/pages/consultation/SessionList/index.jsx|更新|统一状态处理组件|

### 具体变更
- SessionList 组件内根据 loading、error、sessions.length 统一渲染不同状态。（补充信息：后端最多返回 20 条 session）
- 页面主逻辑仅传递状态和数据，具体渲染交由 SessionList 处理。

### 成功标准
- 自动验证：切换网络/数据异常时，页面能正确显示加载、错误、空列表等状态。
- 手动验证：所有状态下页面无异常分支，交互一致。

---

## Phase 3: 新建会话与跳转逻辑抽象

### 目标
- 新建会话与跳转逻辑抽象为可复用 hook 或组件，提升代码复用性。

### 修改文件清单

|文件路径|修改类型|说明|
|---|---|---|
|src/pages/consultation/history.jsx|更新|调用抽象后的新建会话逻辑|
|src/hooks/useNewSession.js|新增|新建会话与跳转 hook|
|src/components/IconActionButton/index.jsx|确认|右侧操作按钮调用新建会话|

### 具体变更
- 新建 `useNewSession` hook，封装新建会话与跳转逻辑。
- 页面与按钮统一调用该 hook，减少重复代码。

### 成功标准
- 自动验证：新建会话流程无异常，跳转逻辑一致。
- 手动验证：多处调用新建会话均能正常跳转，无冗余代码。

---

## Phase 4: 用户与会话上下文解耦

### 目标
- 用户上下文与会话上下文进一步解耦，便于未来扩展。

### 修改文件清单

|文件路径|修改类型|说明|
|---|---|---|
|src/store/UserContext.jsx|确认|用户上下文逻辑|
|src/store/consultSession.jsx|更新|仅依赖会话相关数据|
|src/pages/consultation/history.jsx|更新|用户未登录时跳转逻辑优化|

### 具体变更
- 用户未登录时访问历史会话页面，自动跳转登录页。
- 会话相关逻辑不依赖用户上下文，提升解耦性。

### 成功标准
- 自动验证：未登录用户访问历史会话页自动跳转登录。
- 手动验证：用户与会话逻辑无耦合，便于扩展。

---

## Commit Message 模板

```
feat: 历史会话页面前端优化，统一标准数据结构处理，异常与边界状态统一，抽象新建会话逻辑，解耦用户与会话上下文
```

## PR 描述要点

- 去除冗余兼容分支，统一处理标准化数据结构
- 会话列表与详情分离，API 严格对齐 openapi.js
- SessionList 组件内统一处理加载、异常、空列表状态
- 新建会话与跳转逻辑抽象为 hook
- 用户与会话上下文解耦，提升扩展性

---

### 下一步建议

1. 请确认 SessionList 组件是否需新建或已有可复用组件。
2. 如有特殊 UI 需求或交互细节，请补充说明。
3. 确认后可交付给 Implementer 进行代码实现。

---

如需补充或调整，请告知！

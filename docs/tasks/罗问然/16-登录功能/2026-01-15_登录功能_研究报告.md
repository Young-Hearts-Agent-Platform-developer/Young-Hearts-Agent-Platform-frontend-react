# 登录功能 研究报告

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-15 | v1.1 | 明确无障碍、风格、跳转与记住我需求 | 用户反馈 |
| 2026-01-15 | v1.0 | 初始研究报告 | 新建任务 |

## 研究问题

完成登录界面，实现登录功能。

## 发现摘要

- 项目已具备用户认证相关 API（含 mock 逻辑）、全局用户状态管理（Context）、登录/登出 API 封装。
- 目前 `src/pages/auth/` 目录为空，尚未有实际的登录界面实现。
- 用户登录流程已在 `UserContext` 中实现，支持登录后自动拉取用户信息。
- 用户类型、角色、权限体系已在数据模型和类型定义中明确。
- 登录界面无特殊无障碍要求，风格需参考全局 CSS 变量（见 `src/styles/variables.css`）。
- 登录后直接返回上一页，无需区分用户角色。
- 暂不需要“记住我”或自动登录功能。

## 相关文件清单

|文件路径|作用说明|关键行号|
|---|---|---|
|src/api/auth.js|登录、登出、获取当前用户 API 封装，含 mock 逻辑|L1-121|
|src/store/UserContext.jsx|全局用户状态管理，含登录/登出/权限校验|L1-80|
|src/store/useUser.js|用户信息与操作的自定义 Hook|L1-20|
|src/types/User.js|用户类型定义（JSDoc）|L1-60|
|docs/“心青年”智能体平台-前端界面设计方案.md|界面风格、交互规范|L1-60|
|docs/“心青年”智能体平台-前端-项目结构.md|目录结构、auth 目录说明|L1-60|
|docs/“心青年”智能体平台-数据模型与 API 设计.md|用户、权限、API 设计|L1-100|
|docs/“心青年”智能体平台-功能文档.md|功能规划、用户认证优先级|L1-60|

## 当前实现分析

- **API 层**：`src/api/auth.js` 提供 `login({ username, password })`、`logout()`、`getCurrentUser()` 等方法，开发环境下支持 mock 用户。
- **状态管理**：`src/store/UserContext.jsx` 通过 React Context 提供 `user`、`isAuthenticated`、`login`、`logout`、`checkPermission` 等，`useUser.js` 封装 Hook 便于消费。
- **类型定义**：`src/types/User.js` 详细定义了用户、志愿者、专家等 profile 结构。
- **界面层**：`src/pages/auth/` 目录为空，尚无登录表单组件。
- **文档规范**：界面设计方案已明确风格、色彩、无障碍等要求，项目结构文档说明登录页应位于 `src/pages/auth/`。

### 核心流程

```
[用户输入账号密码] → [调用 login API] → [保存用户信息到 Context] → [跳转首页/个人中心]
```

- 登录成功后自动拉取并存储用户信息，失败时应有错误提示。
- 支持 mock 登录，便于开发测试。

### 关键代码片段

- `src/api/auth.js`：
```js
export async function login({ username, password }) {
  if (import.meta.env.VITE_MODE === 'development') {
    return { user: { ...MOCK_USER }, token: 'mocked_token' };
  }
  const res = await fetch(`${API_BASE}/login`, { ... });
  if (!res.ok) throw new Error('登录失败');
  return await res.json();
}
```
- `src/store/UserContext.jsx`：
```js
const login = async (credentials) => {
  await apiLogin(credentials);
  await fetchUser();
};
```

## 架构洞察

- 已采用 Context 统一管理用户状态，便于全局鉴权与角色控制。
- API 层 mock 设计有利于前后端并行开发。
- 类型定义清晰，便于后续扩展多角色、多 profile。

## 潜在风险和边缘情况

- 登录失败/网络异常时的用户体验与错误提示需补充。
- 生产环境与 mock 环境切换需谨慎，防止 mock 逻辑泄漏至生产。
- 尚无验证码、二步验证等安全机制。

## 开放问题

- （无）当前需求已明确，如有新需求请补充。

## 参考资料

- docs/“心青年”智能体平台-前端界面设计方案.md
- docs/“心青年”智能体平台-前端-项目结构.md
- docs/“心青年”智能体平台-数据模型与 API 设计.md
- docs/“心青年”智能体平台-功能文档.md

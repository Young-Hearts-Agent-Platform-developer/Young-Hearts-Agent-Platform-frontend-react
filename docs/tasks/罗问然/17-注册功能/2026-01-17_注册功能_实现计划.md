# 注册功能 实现计划

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-17 | v1.0 | 初始计划 | 基于研究报告与澄清结论 |

## 关联研究
[docs/tasks/罗问然/17-注册功能/2026-01-17_注册功能_研究报告.md](docs/tasks/罗问然/17-注册功能/2026-01-17_注册功能_研究报告.md)

## 功能概述
实现多角色注册功能，支持动态表单与字段校验。注册成功后跳转登录页，由用户手动登录。多角色可多选，拓展表单分别放在 SectionContainer，顺序为志愿者、专家。UI风格可适当调整。

---

## Phase 1: 注册API前端实现

### 目标
在 src/api/auth.js 中补充 /auth/register POST 方法，严格对齐 openapi.json 字段。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/api/auth.js|新增/修改|实现 register 方法，POST /auth/register|
|openapi.json|只读|对齐字段与规则|

### 具体变更
- 新增 register(data) 方法，返回 Promise。
- 参数与字段严格参照 openapi.json。

### 成功标准
- 自动验证：调用 register 方法，能收到后端响应。
- 手动验证：表单提交后能正确发起注册请求。

---

## Phase 2: 注册表单与动态字段

### 目标
在 src/pages/auth/register.jsx 实现注册表单，支持多角色选择与动态 profile 字段渲染，表单校验。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/pages/auth/register.jsx|重构|实现完整注册表单与交互|
|src/types/User.js|只读/校验|确保字段一致性|
|src/components/SectionContainer/|复用|动态表单分区|

### 具体变更
- 基本信息输入（用户名、密码、手机号等）。
- 角色多选（family/volunteer/expert），允许多选。
- 选择志愿者/专家时，分别在 SectionContainer 展示对应拓展表单，顺序为志愿者、专家。
- 表单校验（必填、格式、密码一致等）。
- UI风格可适当调整。

修改：不适用 SectionContainer 组件，直接在注册页面实现动态表单分区。

### 成功标准
- 自动验证：表单校验逻辑单测（如有）。
- 手动验证：多角色选择与动态表单渲染无误，校验生效。

---

## Phase 3: 注册流程与交互

### 目标
实现注册提交、成功/失败反馈、跳转逻辑，与 login.jsx 入口联动。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/pages/auth/register.jsx|完善|表单提交、反馈、跳转|
|src/pages/auth/login.jsx|微调|注册入口跳转、注册后跳转逻辑|

### 具体变更
- 注册成功后跳转登录页，由用户手动登录。
- 失败时展示错误信息。
- 登录页底部“注册新账号”跳转注册页。

### 成功标准
- 自动验证：注册后路由跳转单测（如有）。
- 手动验证：注册成功后自动跳转登录页，失败有提示。

---

## Phase 4: 用户状态与审核适配

### 目标
注册后根据角色设置激活/未激活状态，个人中心角色标签灰色逻辑预埋。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/types/User.js|只读/校验|注册状态字段一致性|
|src/store/useUser.js|只读/预埋|后续激活状态适配|
|src/store/UserContext.jsx|只读/预埋|后续激活状态适配|

### 具体变更
- 注册API响应需包含激活状态。
- 个人中心角色标签灰色逻辑预埋（如未激活）。

### 成功标准
- 手动验证：注册志愿者/专家后，个人中心角色标签为灰色（后续实现预埋）。

---

## Commit message 模板

feat: 实现多角色注册功能，支持动态表单与注册API

- 新增注册API前端实现
- 注册表单支持多角色与动态拓展字段
- 注册成功后跳转登录页
- 预埋未激活角色标签灰色逻辑

## PR 描述要点
- 支持多角色注册与动态表单渲染
- 注册API严格对齐后端字段
- 注册成功后跳转登录页，由用户手动登录
- 个人中心未激活角色标签灰色逻辑预埋

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-17 | v1.0 | 初始计划 | 基于研究报告与澄清结论 |

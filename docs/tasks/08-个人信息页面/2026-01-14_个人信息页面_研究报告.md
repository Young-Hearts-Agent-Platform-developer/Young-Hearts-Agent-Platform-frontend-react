# 个人信息页面 研究报告

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-14 | v1.0 | 初始设计 | 无 |
| 2026-01-14 | v1.1 | 明确编辑权限、头像上传与扩展信息展示结论 | 用户反馈 |
| 2026-01-14 | v1.2 | 补充Header返回按钮与ListMenu主副标题布局问题分析 | 页面交互问题 |

## 研究问题

1. 新建“个人信息”次级页面，若已经登录，通过在“个人中心”点击个人信息卡片进入，逐条呈现个人信息，并可以通过点击弹窗，进行修改。
2. 若没有登录，则在个人信息卡片右侧添加一个“登录”按钮，点击后跳转至登录界面。

## 发现摘要

- 当前“个人中心”页面已实现个人信息卡片展示，登录态由 `useUser` 提供，未登录时仅显示“未登录”昵称。
- 暂无独立“个人信息”次级页面文件，需新建如 `src/pages/my/PersonalInfo.jsx`。
- 用户信息获取与登录状态判断依赖 `UserContext`，API 由 `src/api/auth.js` 提供。
- 个人信息修改需弹窗表单，调用 `/api/users/profile` 接口（PUT）。
- 未登录时可在卡片右侧加“登录”按钮，跳转 `/auth/login`。

## 相关文件清单

|文件路径|作用说明|关键行号|
|---|---|---|
|src/pages/my/index.jsx|个人中心主页面，个人信息卡片展示|L1-L99|
|src/store/UserContext.jsx|用户上下文与登录态管理|L1-L60|
|src/api/auth.js|用户信息获取、登录登出API|L1-L122|
|src/components/SectionContainer/index.jsx|分区容器组件|L1-L60|
|src/components/ListMenu/index.jsx|功能列表组件|L1-L60|

## 当前实现分析

### 个人中心页面结构
- 个人信息卡片由 `infoCard` 变量渲染，展示头像、昵称、角色标签。
- 用户信息通过 `useUser` 获取，未登录时昵称显示“未登录”。
- 目前未实现点击卡片进入个人信息详情页。
- 功能列表与登出按钮独立分区。

### 登录态判断与跳转
- `UserContext` 提供 `user`、`isAuthenticated`、`login`、`logout` 等。
- 登录跳转可通过 `useNavigate` 实现：`navigate('/auth/login')`。

### 用户信息获取与修改
- `getCurrentUser` 获取当前用户信息，接口为 `/api/auth/me`。
- 修改信息需调用 `/api/users/profile`（PUT），前端需弹窗表单。

### 关键代码片段

- 个人信息卡片渲染（src/pages/my/index.jsx L18-L44）：

```jsx
<SectionContainer className="my-info-card">
  <div style={{ display: 'flex', alignItems: 'center' }}>
    <img src={user?.avatar || userAvatar} ... />
    <div style={{ flex: 1 }}>
      <div>{user ? user.nickname : '未登录'}</div>
      <div>
        {(user?.roles || []).map(...)}
      </div>
    </div>
  </div>
</SectionContainer>
```

- 登录跳转（可参考 src/pages/my/LogoutButton.jsx）：

```js
navigate('/auth/login');
```

## 架构洞察
- 用户上下文与API解耦，便于Mock与扩展。
- 个人信息卡片可复用SectionContainer，风格统一。
- 个人信息编辑建议采用弹窗表单，字段与API严格对齐。

## 潜在风险和边缘情况
- 未登录状态下误操作需友好提示。
- 用户信息字段与后端接口不一致时需兼容处理。
- 弹窗表单需校验（如邮箱、手机号等）。

## 结论与开放问题

### 明确结论
- 个人信息编辑权限**不区分角色**，所有用户均可编辑自身信息。
- 当前**不支持头像上传**，如需支持需补充API与前端实现。
- 若用户拥有对应身份（如志愿者/专家），个人信息详情页**需展示扩展信息**（如志愿者/专家Profile）。

### 仍需关注的开放问题
- 扩展信息的字段与展示规范需与后端接口进一步对齐。
- 后续如需支持头像上传，需补充接口与前端交互设计。

---

## v1.2 追加：Header返回按钮与ListMenu主副标题布局问题

### 研究问题
1. 个人信息页面，Header 的返回按钮失效
2. ListMenu没有实现主标题居左，副标题居右

### 发现摘要
- 个人信息页面的 Header 由 SubLayout 统一渲染，返回按钮依赖 showBack 和 onBack 传参，当前未传递 onBack，导致返回按钮无效。
- ListMenu 组件已通过 flex 实现主副标题分列，但主副标题的 props 命名与实际数据结构不一致，主标题应为 label，副标题应为 value。

### 相关文件清单
|文件路径|作用说明|关键行号|
|---|---|---|
|src/pages/my/PersonalInfo.jsx|个人信息页面主文件|全文件|
|src/layouts/SubLayout.jsx|二级页面布局，Header 包裹|全文件|
|src/components/Header/index.jsx|头部组件，含返回按钮|全文件|
|src/components/ListMenu/index.jsx|功能列表组件，主副标题布局|全文件|

### 当前实现分析
#### Header 返回按钮失效分析
- PersonalInfo 页面通过 SubLayout 包裹，SubLayout 内 Header 组件 showBack 固定为 true，但 onBack 未传递。
- Header 组件基于 antd-mobile NavBar，back 属性仅控制显示，未绑定返回事件。
- SubLayout 支持 onBack props，但 PersonalInfo 未传递，导致点击返回无动作。

#### ListMenu 主副标题布局分析
- ListMenu 组件内部已用 flex 布局主副标题（label/value），但部分 props 命名与 README 示例（title/desc）不一致。
- PersonalInfo 页面传递的 items 使用 label/value，实际渲染时主标题居左、副标题居右。
- 若需自定义样式，可通过 .list-menu-title/.list-menu-value CSS 类进一步调整。

#### 关键代码片段
- SubLayout.jsx
```jsx
<Header
  title={title}
  subtitle={subtitle}
  showBack
  rightActions={rightActions}
  back={onBack}
/>
```
- Header/index.jsx
```jsx
<NavBar
  back={showBack ? '返回' : null}
  right={rightActions}
  ...
/>
```
- ListMenu/index.jsx
```jsx
<div className="list-menu-content" style={{ flex: 1, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
  <span className="list-menu-title" style={{ textAlign: 'left' }}>{item.label || item.title}</span>
  <span className="list-menu-value" style={{ textAlign: 'right', color: '#888' }}>{item.value || item.desc}</span>
</div>
```

### 架构洞察
- Header 返回按钮事件需由页面传递 onBack，建议统一由 SubLayout 处理。
- ListMenu 支持主副标题分列，props 命名需与业务数据结构保持一致。

### 潜在风险和边缘情况
- 若页面未传递 onBack，返回按钮无效，用户体验受损。
- ListMenu 业务字段命名不一致可能导致渲染异常。

### 开放问题
- 是否所有二级页面都需自定义返回逻辑？
- ListMenu 是否需支持更多自定义布局？

### 参考资料
- antd-mobile NavBar 文档
- 项目内 README 及组件注释

## 参考资料
- docs/“心青年”智能体平台-数据模型与 API 设计.md
- src/api/auth.js
- src/store/UserContext.jsx


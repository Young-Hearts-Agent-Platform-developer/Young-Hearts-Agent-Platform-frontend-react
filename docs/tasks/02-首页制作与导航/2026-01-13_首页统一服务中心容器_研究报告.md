# 首页统一服务中心容器 研究报告

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-13 | v1.0 | 初始研究报告 | 新增“统一服务中心”容器需求 |
| 2026-01-13 | v1.1 | 明确分区独立与角色控制方案 | 需求澄清与实现调研 |
| 2026-01-13 | v1.2 | 回答开放问题，补充入口与实现方案 | 需求进一步细化 |
| 2026-01-13 | v2.0 | 全面更新：结合代码现状、组件能力、身份体系与设计文档 | 代码库与设计方案同步 |

## 研究问题

根据最新前端界面设计，首页需补充“统一服务中心”分区，要求与“暖心服务站”完全独立，均用 SectionContainer/Card 组件实现。统一服务中心内容静态配置，需预留角色控制接口（如对患者家属隐藏），身份体系建议用 context。

## 发现摘要

- 首页 index.jsx 当前仅有“暖心服务站”分区，未见“统一服务中心”分区代码。
- SectionContainer/Card 组件高度可复用，支持分区、入口卡片、条件渲染，Card 支持 requiredRole/hidden 属性。
- 用户身份体系已通过 UserContext/useUser 提供，支持 roles 判断与 checkPermission，可用于分区/入口的权限控制。
- 设计文档明确“统一服务中心”分区需与“暖心服务站”独立，内容静态，后续可通过 context 控制角色可见性。
- 推荐实现：在首页 index.jsx 中，基于 useUser/useContext 判断角色，条件渲染 SectionContainer（title="统一服务中心"），内容参考设计文档，入口卡片可用 Card 组件并配置 requiredRole/hidden。

## 相关文件清单

|文件路径|作用说明|关键行号|
|---|---|---|
|src/pages/home/index.jsx|首页主页面，分区与入口实现|L1-L120|
|src/components/SectionContainer/README.md|分区容器组件说明与用法|L1-L50|
|src/components/Card/README.md|Card组件说明与用法|L1-L50|
|src/store/UserContext.jsx|用户身份体系与权限判断|L1-L60|
|src/store/useUser.js|用户身份 hooks|L1-L20|
|docs/page-designs/首页-页面设计.md|首页分区与入口设计规范|L1-L120|

## 当前实现分析

### 现状
首页 index.jsx 仅有“暖心服务站”分区，所有入口静态渲染，未见“统一服务中心”分区代码。未做角色控制，所有用户均可见。

### 组件能力
- SectionContainer 支持分区标题、描述、嵌套与自定义内容，适合承载服务中心等结构化区域。
- Card 组件支持主卡/副卡/分类卡/专家卡，具备 requiredRole/hidden 属性，可用于条件渲染。

### 用户身份体系
- UserContext.jsx 提供 user、roles、checkPermission 等，支持全局身份与权限判断。
- useUser.js 提供 hooks，便于在页面/组件中获取用户身份与权限。

### 推荐实现流程

1. 在首页 index.jsx 中引入 useUser/useContext，获取用户身份。
2. 条件渲染 SectionContainer（title="统一服务中心"），如：
```jsx
const { user, checkPermission } = useUser();
// ...existing code...
{checkPermission('service-center-visible') && (
  <SectionContainer title="统一服务中心">
    <Card title="服务A" requiredRole="service-center-visible" />
    <Card title="服务B" requiredRole="service-center-visible" />
    {/* 具体入口与内容详见设计文档，仅静态内容 */}
  </SectionContainer>
)}
```
3. 入口内容参考 docs/page-designs/首页-页面设计.md，静态配置。
4. 后续可通过 user.roles 或 checkPermission 控制分区/入口可见性。

### 核心流程

```
HomeLayout
  ├── SectionContainer（title="暖心服务站"）
  │      └── Card ...
  └── SectionContainer（title="统一服务中心"，条件渲染，内容静态配置）
         └── Card ...
```

### 关键代码片段

- 用户身份体系
  - src/store/UserContext.jsx L1-L60
  - src/store/useUser.js L1-L20
- 分区与入口实现
  - src/pages/home/index.jsx L1-L120
- 组件用法
  - src/components/SectionContainer/README.md L1-L50
  - src/components/Card/README.md L1-L50

## 架构洞察

- “统一服务中心”与“暖心服务站”应为完全独立分区，便于权限与内容解耦。
- SectionContainer/Card 组件高度可复用，支持灵活扩展与条件渲染。
- 用户身份体系建议由 context 统一管理，便于后续接入统一身份体系。
- 入口与内容静态配置，便于前后端协同与维护。

## 潜在风险和边缘情况

- 卡片数量增加时，需关注布局自适应与响应式表现。
- 入口跳转需确保路由与权限校验。
- SectionContainer 与 Card 主题风格需与整体 UI 保持一致。
- 角色判断逻辑需与后端/全局身份体系保持一致，避免前后端不一致导致的越权或误隐藏。
- 若 requiredRole/hidden 配置不当，可能导致入口误显示或误隐藏。

## 开放问题

- 统一服务中心分区的入口内容是否需动态配置？
- 角色控制的粒度与后端身份体系如何对齐？
- 是否需支持多角色复合可见性？

## 参考资料
- docs/page-designs/首页-页面设计.md
- src/components/SectionContainer/README.md
- src/components/Card/README.md
- src/store/UserContext.jsx
- src/store/useUser.js

### 统一服务中心容器：角色-卡片分配矩阵

| 角色         | 首页是否展示服务中心 | 可见卡片/入口（功能）                                                                 |
|--------------|---------------------|--------------------------------------------------------------------------------------|
| 患者家属     | 否                  | 无                                                                                   |
| 志愿者       | 是                  | 工作台、知识贡献、任务大厅、工单详情、排班/活动管理、服务记录                        |
| 专家         | 是                  | 工作台、知识贡献、知识审核列表、审核详情、任务大厅、工单详情                         |
| 管理员       | 是                  | 工作台、人员管理、排班/活动管理                                                      |
| 维护人员     | 是                  | 工作台、运维监控                                                                     |

> 注：各角色仅能访问自身权限范围内的卡片，具体功能入口由前端根据用户身份动态渲染。

#### 前端鉴权渲染建议

1. **首页服务中心区块渲染逻辑**：
   - 若当前用户角色为“患者家属”，不渲染统一服务中心区块。
   - 若为“志愿者/专家/管理员/维护人员”，渲染服务中心区块，并根据角色分配对应卡片。
2. **卡片/入口动态分配**：
   - 前端应根据用户身份（如 user.role）筛选可见卡片，避免越权访问。
   - 建议将卡片分组渲染，便于后续扩展（如多角色叠加时的交集处理）。
3. **路由守卫建议**：
   - 即使前端隐藏入口，仍需在路由层做权限校验，防止用户通过 URL 直接访问未授权页面。
4. **UI提示**：
   - 若用户尝试访问无权限页面，建议弹出“无访问权限”提示，并自动跳转至首页。


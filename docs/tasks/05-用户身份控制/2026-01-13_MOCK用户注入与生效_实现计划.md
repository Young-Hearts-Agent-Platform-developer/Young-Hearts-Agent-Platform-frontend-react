# MOCK 用户注入与生效实现计划

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-13 | v1.0 | 初始计划 | 基于 MOCK 用户未生效研究报告与澄清 |

## 关联研究
[docs/tasks/05-用户身份控制/2026-01-13_MOCK用户未生效原因_研究报告.md](docs/tasks/05-用户身份控制/2026-01-13_MOCK用户未生效原因_研究报告.md)

## 功能概述
为提升前端开发体验，在开发环境下自动注入 MOCK 用户数据，确保个人中心等页面可正常显示用户信息，无需依赖后端接口。

---

## Phase 1: MOCK 用户数据结构与配置

### 目标
定义标准 MOCK 用户数据结构，便于后续扩展与切换配置方式。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/api/auth.js|新增/调整|定义 MOCK 用户对象|

### 具体变更
- 在 src/api/auth.js 顶部定义 MOCK 用户对象，字段包括 nickname、role、avatar 等。
- 预留后续切换为独立 mock 文件或环境变量的接口。

### 成功标准
- MOCK 用户对象结构清晰，字段覆盖页面所需。

---

## Phase 2: API 层注入 MOCK 用户逻辑

### 目标
仅在开发环境下，getCurrentUser 方法优先返回 MOCK 用户数据。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/api/auth.js|更新|getCurrentUser 增加开发环境判断与 MOCK 返回|

### 具体变更
- 在 getCurrentUser 方法中，判断 process.env.NODE_ENV === 'development' 时直接返回 MOCK 用户。
- 生产环境保持原有逻辑。

### 成功标准
- 开发环境下 getCurrentUser 返回 MOCK 用户，页面可正常显示。
- 生产环境不受影响。

---

## Phase 3: 个人中心页面验证与切换

### 目标
确保个人中心页面能正确显示 MOCK 用户信息，支持手动/自动切换。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/pages/my/index.jsx|验证/调整|页面显示 MOCK 用户信息|
|src/store/UserContext.jsx|验证|上下文兼容 MOCK 用户|

### 具体变更
- 验证页面是否正确显示 MOCK 用户信息。
- 如需手动切换，预留切换入口（如 URL 参数或按钮）。

### 成功标准
- 页面显示 MOCK 用户昵称、角色等信息。
- 切换逻辑可用（如有）。

---

## Phase 4: 验证步骤设计

### 目标
确保方案可自动化与手动验证。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|无|新增|验证命令与手动步骤说明|

### 具体变更
- 自动验证：npm run dev 启动后，页面显示 MOCK 用户信息。
- 手动验证：切换 NODE_ENV 为 production，页面显示“未登录”或真实用户。

### 成功标准
- 自动与手动验证均通过。

---

## PR/Commit 模板

- commit message: feat: 支持开发环境下自动注入 MOCK 用户
- PR 描述要点：新增 MOCK 用户数据结构，API 层注入逻辑，页面验证与切换方案，完善验证步骤。

---

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-13 | v1.0 | 初始计划 | 基于 MOCK 用户未生效研究报告与澄清 |

---

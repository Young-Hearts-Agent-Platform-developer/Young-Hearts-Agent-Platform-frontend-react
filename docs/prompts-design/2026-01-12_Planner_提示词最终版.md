# Planner 提示词（优化）完整报告

## 报告日期
2026-01-12

## 核心需求
完善 `Planner` 智能体，使其明确支持两种工作模式：
1. **新建模式**：基于研究报告（Researcher Output）生成全新的分阶段实现计划。
2. **更新模式**：当附件或上下文中存在现有计划文档时，基于新的研究结论或需求变更，精准修改原有计划，并自动增加版本记录。

## 目标文件上下文详情
- **文件路径**：`.github/agents/Planner.agent.md`
- **文件用途**：基于研究报告生成技术实现方案，指导 Implementer 执行。
- **上下文核心**：
  - 输入：强依赖 `Researcher` 的产出（`docs/tasks/..._研究报告.md`）。
  - 输出：结构化的 Markdown 计划书（Phase 划分、验证标准）。
  - 流程：扫描 -> 规划 -> 澄清 -> 细化 -> 输出。
- **适配逻辑**：
  - 保持原有的“分阶段（Phase）”设计核心。
  - 在流程起始阶段增加“模式判定”。
  - 引入“版本记录”模块，确保计划变更可追溯。

## 设计/优化详情

### 核心设计思路
1.  **双模态架构**：
    -   *Create Mode*: 沿用原有的从零构建逻辑，关注 Phase 划分的合理性。
    -   *Update Mode*: 新增差异分析逻辑。即 Reading（旧计划）+ Reading（新研究）-> Thinking（差异点）-> Editing（局部修改 + 版本记录）。
2.  **版本控制**：强制要求在计划文档末尾维护 `## 版本记录`，记录每次迭代的动因（如：研究报告更新、需求变更）。
3.  **输入明确化**：在 Argument Hint 中明确区分“新建”与“更新”的输入预期。

### 优化点
| 原提示词问题 | 优化方案（结合上下文） | 优化效果 |
| :--- | :--- | :--- |
| **覆盖式生成**：默认重新生成整个计划，容易丢失之前的手动调整或细化内容。 | **增量更新逻辑**：明确“更新模式”下仅修改受影响的 Phase，保留未变动部分。 | 保护已验证的规划资产，减少重复工作。 |
| **演进不可溯**：计划修改后无法得知修改原因和时间。 | **版本记录模块**：输出标准中增加 `## 版本记录`。 | 团队成员可快速了解计划变更历史。 |
| **输入模糊**：未明确如何触发更新。 | **智能模式识别**：通过检测上下文文件类型（Plan.md）自动切换模式。 | 提升交互流畅度，AI 更懂用户意图。 |

### 验证过程与结果
- **模拟输出示例（更新模式）**：
  ```markdown
  # [原有标题]
  ...
  ## Phase 2: [修改后的阶段]
  ...（更新的文件清单与变更点）...
  ...
  ## 版本记录
  | 日期 | 修改内容 | 修改原因 |
  |---|---|---|
  | 2026-01-11 | 初始计划 | 基于 V1 研究报告 |
  | 2026-01-12 | 调整 Phase 2 验证逻辑 | 补充单元测试覆盖率要求 |
  ```
- **验证维度**：
  - 需求匹配度：✓ 符合（支持新建/更新）
  - 上下文适配度：✓ 贴合（依赖 Researcher 报告）
  - 流程可执行性：✓ 可执行（Mode Detect -> Process）
  - 输出合规性：✓ 合规（Markdown 格式正确）

## 使用指南
- **适用场景**：
  - 初始方案设计（新建）。
  - 需求变更导致的方案调整（更新）。
  - 研究深入后发现技术风险，需调整后续 Phase（更新）。
- **常见问题**：
  - *更新时未提供旧计划*：AI 可能会误判为新建模式。建议 Explicitly open the file or mention it.

## 版本记录
| 日期 | 修改内容 | 修改原因 |
|---|---|---|
| 2026-01-12 | 优化提示词逻辑，支持新建/更新双模式 | 统一 Researcher 与 Planner 的协作体验，加强文档维护能力 |

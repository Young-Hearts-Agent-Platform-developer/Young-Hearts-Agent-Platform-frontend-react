# Researcher 提示词（优化）完整报告

## 报告日期
2026-01-12

## 核心需求
完善 `Researcher` 智能体，使其明确支持两种工作模式：
1. **新建模式**：当附件或上下文中无现有研究报告时，生成全新的结构化研究报告。
2. **更新模式**：当附件或上下文中存在研究报告时，基于新指令修改原有报告的相关内容，并自动增加版本记录（修改时间、内容、原因）。

## 目标文件上下文详情
- **文件路径**：`.github/agents/Researcher.agent.md`
- **文件用途**：作为代码库研究专家代理，协助开发者调查代码实现、生成或维护技术文档。
- **上下文核心**：
  - 输入通常为“研究主题”和“搜索范围”。
  - 输出为 markdown 格式的结构化报告，存储在 `docs/tasks/` 下。
  - 需要强依赖 `copilot` 的文件读写能力。
- **适配逻辑**：
  - 保留原有的严谨研究流程（定位-分析-洞察）。
  - 新增“模式判定”逻辑，通过检测上下文文件来决定是 `create` 还是 `update`。
  - 修改输出模板，引入 `## 版本记录` 模块以适配更新需求。

## 设计/优化详情

### 核心设计思路
1.  **动态角色适应**：角色定义中明确“维护者”的身份，不仅仅是“生成者”。
2.  **流程分支化**：在执行流程的第一步引入“环境扫描”，判断是新建还是更新。
    - *新建*：执行标准全量研究 -> 使用标准模板 -> 保存。
    - *更新*：读取旧文件 -> 执行增量研究 -> 定位需修改段落 -> 追加版本记录 -> 保存。
3.  **标准化版本控制**：在输出标准中强制要求 Markdown 表格形式的 `## 版本记录`，确保文档演进可追溯。

### 优化点
| 原提示词问题 | 优化方案（结合上下文） | 优化效果 |
| :--- | :--- | :--- |
| **模式单一**：默认只生成新报告，更新现有报告时指令模糊，容易覆盖或丢失历史信息。 | **新增流程分支**：明确区分“新建”与“更新”两种路径，分别定义操作规范。 | AI 能自动识别意图，由盲目重写变为精准修订，保护历史资产。 |
| **缺乏历史记录**：多次研究同一主题时，无法追踪变更历史。 | **新增版本记录模板**：在输出标准中加入 `## 版本记录` 章节。 | 每次修改都有据可查，便于团队协作与回溯。 |
| **输入提示不足**：未告知用户如何触发更新模式。 | **优化 YAML Hint**：明确提示用户在更新模式下需引用现有文件。 | 降低用户使用门槛，提高交互成功率。 |

### 验证过程与结果
- **模拟输出示例（更新模式）**：
  ```markdown
  # [原有标题]
  ...（原有内容更新）...
  ## 版本记录
  | 日期 | 修改内容 | 修改原因 |
  |---|---|---|
  | 2026-01-11 | 初始创建 | 基础功能研究 |
  | 2026-01-12 | 更新用户认证模块分析 | 鉴权逻辑变更，同步文档 |
  ```
- **验证维度**：
  - 需求匹配度：✓ 符合（明确了两种模式）
  - 上下文适配度：✓ 贴合（沿用原有文件结构）
  - 角色清晰度：✓ 清晰（定义了研究者与维护者双重身份）
  - 流程可执行性：✓ 可执行（逻辑分支明确）
  - 输出合规性：✓ 合规（Markdown 格式正确）

## 使用指南
- **适用场景**：
  - 新功能开发前的技术调研（新建）。
  - 功能迭代引起的代码变更追踪（更新）。
  - 补充遗漏的研究视角（更新）。
- **调整建议**：若项目有特定的版本号管理规范（如 v1.0, v1.1），可在版本记录中增加“版本号”列。
- **常见问题**：
  - *AI 无法识别现有文件*：请确保在对话中显式引用了该文件（Open Edit 或 `#filename`）。
  - *覆盖原有内容*：提示词已强调“针对性修改”，但建议在 Copilot 预览时确认。

## 版本记录
| 日期 | 修改内容 | 修改原因 |
|---|---|---|
| 2026-01-12 | 优化提示词逻辑，支持新建/更新双模式 | 响应用户对文档维护与版本管理的需求 |

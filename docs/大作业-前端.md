# 大作业要求

### 一、封面填写与格式规范
1. 填写核心信息：在封面指定横线处居中填写「题目」（左右可适当留空，用下划线空格形式）、「院系」（固定为未来书院/未来技术学院）、「班级」（未来25XX）、「学生姓名」、「学号」（2025XXXXXXX）、「完成日期」（2026年XX月XX日）。
2. 格式要求：保证院系、班级、姓名、学号四条横线长度基本一致，底部「大连理工大学未来技术学院」需居中对齐（忽略模板中显示空格的小圆点）。

### 二、正文各章节内容撰写与格式处理
#### （一）问题描述部分
1. 内容要求：面向初学者讲解课程设计背景（如走迷宫规则），清晰说明问题核心，可适当加粗关键信息（避免整段加粗）。
2. 格式要求：
   - 正文：宋体、小四字号，英文/数字用Times new roman（字号与对应中文一致）。
   - 配图：需居中放置、设为「嵌入型」，无特殊需求无需加粗边框；每张图需标注编号（如图1-1）和图说（宋体、五号），图说与后续正文留空（回车空行或调整段间距）。
3. 具体工作：撰写背景+问题说明（适配初学者理解），准备相关配图并按要求设置格式、补充图说。

#### （二）设计思路部分
1. 内容要求：
   - 明确问题定义（如探索类/最优路径规划类问题）。
   - 详细阐述所用算法、模型的原理（如Q-Learning、卷积机制等）。
   - 可附辅助图表（如图2-1卷积感受野图）帮助说明。
2. 具体工作：梳理解题逻辑，撰写算法/模型原理说明，准备辅助图表并合理排版。

#### （三）关键代码示例部分
1. 内容要求：提取代码中的核心部分进行展示（无需完整代码，突出关键逻辑）。
2. 格式要求：
   - 代码字体：Consolas、小五字号。
   - 格式修正：若从高亮工具复制的代码出现「 」（非标准空格），需通过「查找替换」统一改为普通空格。
3. 具体工作：筛选关键代码片段，按指定字体格式排版，修正代码中的空格错误。

#### （四）效果展示部分
1. 内容要求：以「图文并茂」形式展示实践成果，确保信息清晰。
2. 格式要求：
   - 图片大小：调整至适中（不偏小导致看不清，不偏大导致内容空洞）。
   - 排版禁忌：避免多张图片因布局问题重合（如图4-1的错误情况）。
3. 具体工作：准备实践效果图片（如迷宫测试结果图），合理搭配文字说明，排版图片避免重合。

#### （五）存在的问题及展望部分
1. 内容要求：
   - 明确本次实践已完成的核心内容。
   - 客观分析实践中存在的不足（如算法效率、模型适配性等问题）。
   - 提出具体的改进方向（如优化算法参数、引入更合适的模型等）。
2. 具体工作：总结成果、梳理问题、规划改进方向，撰写该部分正文。

### 三、提交前的最终处理
1. 文件格式转换：将编辑好的doc/docx文件导出为PDF（WPS选「输出为PDF」，Word选「导出PDF」）。
2. 提交物整理：
   - 新建文件夹，命名格式为「序号-姓名-班级-学号」（如1-张三-未来25XX班-2025XXXXXXX）。
   - 文件夹内分类存放：
     - 报告文件：doc/docx格式+PDF格式（文件名与文件夹命名一致）。
     - 辅助文件：图片统一放入一个文件夹，代码文件统一放入一个文件夹。
     - 特殊要求（赛道三）：额外添加不超过3分钟的效果展示视频（仅展示效果，不出现代码或其他无关内容）。
3. 配图规范：所有图片需用「截图形式」（实物需拍照的除外），禁止使用手机拍摄的照片。


# 大作业内容

## 一、问题描述

### 1.1 项目背景
孤独症群体（“心青年”）及其家庭在长期的康复与生活中，面临着专业知识获取难、个性化建议匮乏的痛点。传统的互联网搜索模式往往只能提供碎片化、通用化的信息，难以针对具体的家庭情况给出有同理心且权威的指导。此外，志愿者与专家资源分散，缺乏统一的协作平台来承接复杂的咨询工单。

### 1.2 核心问题
本项目旨在解决以下核心问题：
1.  **信息检索的局限性**：传统基于关键词的搜索无法理解家长模糊、口语化的提问，且难以辨别医疗建议的真伪。
2.  **服务资源的离散性**：知识的录入、志愿者的招募排班、专家的审核指导通常分散在不同渠道，缺乏高效的统一管理。

### 1.3 解决目标
构建一个基于 **RAG（检索增强生成）技术** 的“心青年”智能体平台。该平台将作为连接患者家庭、志愿者与专家的桥梁，通过 AI 大模型结合专业知识库提供 7x24 小时的智能问答服务，并在 AI 无法解决时无缝流转至人工工单，实现“智能+人工”的双重保障。

## 二、设计思路

### 2.1 总体架构设计
本项目采用前后端分离的现代化 Web 架构，确保系统的可维护性与扩展性。
*   **前端**：基于 React 18 + Vite 构建，使用 Ant Design Mobile 组件库适配移动端体验，实现响应式交互界面。
*   **后端**：采用 Python FastAPI 框架，利用 Pydantic 进行严格的数据校验，提供高性能 API 服务。
*   **AI 引擎**：引入 LangChain 编排框架与 ChromaDB 向量数据库，构建 RAG 系统，实现知识库的语义检索与 LLM 回答生成。

### 2.2 核心算法与模型原理
**RAG（Retrieval-Augmented Generation）检索增强生成** 是平台的核心逻辑：
1.  **知识入库**：系统将上传的 PDF/MD 格式专业文档通过 Text Splitter 切分为语义片段，利用 Embedding Model 转化为向量并存储至向量数据库。
2.  **语义检索**：当用户提问时，系统将问题转化为向量，在数据库中检索 Top-K 相似的知识片段。
3.  **生成回答**：将检索到的上下文与用户的原始问题组装成 Prompt，输送给大语言模型（LLM），生成基于事实、带有引用来源的专业回答。

### 2.3 权限与角色体系
设计了细粒度的 **RBAC（Role-Based Access Control）** 权限模型，包含五种角色：
*   **患者家属**：使用智能咨询，提交人工工单。
*   **志愿者**：认领工单，贡献知识库草稿，参与线下活动。
*   **专家**：审核知识库与工单，处理疑难问题。
*   **管理员/运维**：负责人员准入、系统配置与数据大盘。

## 三、关键代码示例

### 3.1 前端 API 封装与请求标准化
为了规范前后端交互，项目对 `fetch` 请求进行了统一封装，支持流式响应（SSE）以适配 AI 打字机效果。

```javascript
/* src/api/consult.js - 智能咨询模块 API */
import { API_BASE_URL } from '../config/apiConfig';

const API_BASE = `${API_BASE_URL}/api/consult`;

/**
 * chatSSE - 基于 fetch+ReadableStream 的 AI 对话流式接口
 * 实现与后端 SSE 端点的对接，支持实时接收大模型输出
 */
export async function chatSSE(params, onMessage, onError) {
  const url = `${API_BASE}/chat`;
  
  try {
    const response = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(params),
    });

    if (!response.ok) throw new Error('网络请求失败');
    
    // 处理流式响应
    const reader = response.body.getReader();
    const decoder = new TextDecoder();
    
    while (true) {
      const { done, value } = await reader.read();
      if (done) break;
      const chunk = decoder.decode(value, { stream: true });
      onMessage(chunk); // 回调处理增量文本
    }
  } catch (error) {
    onError(error);
  }
}
```

### 3.2 全局用户状态管理
使用 React Context 实现全局状态管理，结合 Token 处理用户登录状态与角色权限映射。

```jsx
/* src/store/UserContext.jsx - 用户上下文 */
import React, { createContext, useState, useEffect, useCallback } from 'react';
import { getCurrentUser } from '../api/auth';

export const UserContext = createContext();

export const UserProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  // 初始化拉取当前用户信息
  const fetchUser = useCallback(async () => {
    setLoading(true);
    try {
      const res = await getCurrentUser();
      // 数据标准化与兜底
      const normalized = {
        ...res,
        avatar: res.avatar || '/default-avatar.png',
        nickname: res.nickname || res.username,
      };
      setUser(normalized);
    } catch {
      setUser(null);
    } finally {
      setLoading(false);
    }
  }, []);

  useEffect(() => {
    fetchUser();
  }, [fetchUser]);

  return (
    <UserContext.Provider value={{ user, setUser, loading, fetchUser }}>
      {children}
    </UserContext.Provider>
  );
};
```

### 3.3 业务 Hook 封装
封装自定义 Hook `useNewSession`，分离 UI 组件与业务逻辑，统一处理新建会话的鉴权与跳转。

```javascript
/* src/hooks/useNewSession.js */
import { useContext } from 'react';
import { useNavigate } from 'react-router-dom';
import { UserContext } from '../store/UserContext';
import { useConsultSession } from '../store/consultSession';

export default function useNewSession() {
  const { user } = useContext(UserContext);
  const navigate = useNavigate();
  const { newSession } = useConsultSession();

  const createSession = async (...args) => {
    if (!user) {
      // 未登录拦截
      navigate('/auth/login');
      throw new Error('未登录');
    }
    const session = await newSession(...args);
    return session;
  };

  return { createSession };
}
```

## 四、效果展示

### 4.1 智能咨询界面
如图 4-1 所示，这是平台的“智能咨询”核心页面。界面采用气泡式对话布局，用户输入问题后，AI 能够通过打字机效果实时输出回答，并在卡片底部附带参考的知识库引用来源。

(在此处插入截图：智能咨询聊天界面，展示这一问一答及引用来源)
<center>图 4-1 智能咨询对话界面</center>

### 4.2 个人中心与角色标识
图 4-2 展示了个人中心页面。并在顶部清晰展示了当前用户的头像及“志愿者”、“专家”等身份标签。不同角色登录后，此页面的功能菜单（如排班管理、工单审核）会自动进行权限过滤与动态渲染。

(在此处插入截图：个人中心页面，展示用户信息卡片与功能菜单)
<center>图 4-2 个人中心与角色菜单</center>

## 五、存在的问题及展望

### 5.1 当前成果
本次实践成功搭建了“心青年”智能体平台的前后端 MVP（最小可行性产品）。实现了基于身份验证的用户系统、基于 LangChain + ChromaDB 的 RAG 问答链路，以及响应式的移动端前端界面。验证了利用 AI 辅助垂直领域咨询的可行性。

### 5.2 存在的不足
1.  **响应延迟**：在处理长文本检索与大模型推理时，首字生成时间（TTFT）仍有优化空间，受限于当前服务器资源。
2.  **知识库覆盖面**：目前的测试数据主要覆盖了通用的康复知识，对于特定地区、特定政策的细粒度数据尚需扩充。
3.  **交互形式单一**：当前仅支持纯文本与 Markdown 交互，缺乏语音输入与多模态（图片/视频）理解能力。

### 5.3 未来改进方向
1.  **性能优化**：引入 Redis 缓存高频问题的向量检索结果，减少对 Embedding 服务的调用次数。
2.  **个性化记忆**：构建用户画像模块（User Profile），让 AI 能够记住家庭的具体情况（如孩子年龄、历史病程），提供更具针对性的长期建议。
3.  **多模态升级**：接入语音识别（ASR）与语音合成（TTS）模块，降低老年家长或视障用户的使用门槛。




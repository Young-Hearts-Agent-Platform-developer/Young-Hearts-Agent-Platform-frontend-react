# 历史会话页面 实现计划

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-18 | v1.0 | 初始计划 | 基于 2026-01-18 研究报告 |

## 关联研究
[docs/tasks/罗问然/02-历史会话页面/2026-01-18_历史会话页面_研究报告.md](docs/tasks/罗问然/02-历史会话页面/2026-01-18_历史会话页面_研究报告.md)

## 功能概述
实现“历史会话”页面，支持：
- 使用 SubLayout，顶部标题“历史会话”，右侧“新对话”按钮
- 展示当前用户历史会话列表，支持点击进入详情
- “新对话”按钮直接创建空会话并跳转
- 空列表时显示“暂无历史会话，快去创建吧！”
- 参考数据结构文档，API 见研究报告

---

## Phase 1: API 与数据结构梳理

### 目标
- 明确会话数据结构，补充/新建 consult 相关 API 文件

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/api/consult.js|新增/修改|定义 get/post /api/consult/sessions 接口|
|docs/“心青年”智能体平台-数据模型与 API 设计.md|参考|数据结构参考|

### 具体变更
- 新建/补充 consult.js，导出 getSessions、createSession 方法
- 会话结构参考数据模型文档（如 sessionId, title, createdAt, lastMessage 等）

### 成功标准
- 自动验证：API 方法单元测试通过
- 手动验证：可通过控制台调用获取/新建会话

---

## Phase 2: 历史会话页面搭建

### 目标
- 新建页面，集成 SubLayout，右侧“新对话”按钮
- 加载并渲染会话列表，支持点击跳转

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/pages/consultation/history.jsx|新增|主页面实现|
|src/layouts/SubLayout.jsx|复用|---|
|src/components/IconActionButton/index.jsx|复用|右侧按钮|

### 具体变更
- 新建 history.jsx，使用 SubLayout，右侧为“新对话”按钮
- 按接口加载会话列表，渲染 SessionList
- 点击会话跳转 /consultation/chat/:sessionId

### 成功标准
- 自动验证：页面渲染无报错，按钮可点击
- 手动验证：页面可正常展示、跳转

---

## Phase 3: 状态管理与复用组件

### 目标
- 新建/补充会话状态管理，抽象会话列表组件

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/store/consultSession.js|新增|管理会话列表/当前会话|
|src/pages/consultation/SessionList/index.jsx|新增|会话列表复用组件|

### 具体变更
- 新建 store/consultSession.js，管理会话列表、加载状态
- 新建 SessionList 组件，支持空、加载、异常等状态
- 空列表时显示“暂无历史会话，快去创建吧！”

### 成功标准
- 自动验证：状态管理单元测试通过
- 手动验证：空/加载/异常状态表现正确

---

## Phase 4: 交互与跳转完善

### 目标
- 完善“新对话”按钮逻辑，创建后跳转
- 权限校验与异常处理

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/pages/consultation/history.jsx|补充|完善跳转、异常处理|
|src/pages/consultation/chat.jsx|复用/补充|跳转目标页面|
|src/store/consultSession.js|补充|异常/权限处理|

### 具体变更
- “新对话”按钮调用 createSession，跳转新会话
- 未登录跳转登录页/提示
- 异常处理（如接口失败）
- 去除掉 chat 页面多余的返回历史会话按钮

### 成功标准
- 自动验证：跳转逻辑单元测试
- 手动验证：新建会话后可正常跳转，异常有提示

---

## PR 提交模板

- feat: 实现历史会话页面及相关 API/组件
- 说明：实现历史会话页面，支持会话列表展示、新建会话、跳转、状态管理等

---


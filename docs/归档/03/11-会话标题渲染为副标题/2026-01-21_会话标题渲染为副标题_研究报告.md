# 会话标题渲染为副标题 研究报告

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-21 | v1.0 | 初始设计 | 无 |

## 研究问题

将会话的标题（TOPIC）渲染为 chat 页面的副标题（默认为“新对话”）。

## 发现摘要

- chat 页面当前未显示会话标题，副标题区域可用于展示。
- 会话标题（topic）需从后端接口获取，通常与会话详情或消息接口相关。
- 若无标题，副标题应显示“新对话”。
- 需梳理数据流、接口调用与 UI 组件传递。

## 相关文件清单

|文件路径|作用说明|关键行号|
|---|---|---|
|src/pages/consultation/chat.jsx|chat主页面，副标题渲染位置|全文件|
|src/api/consult.js|会话相关API，需查找获取topic的接口|相关接口|
|src/components/SubLayout.jsx|页面布局与副标题渲染|副标题props相关|
|src/pages/consultation/MessageList.jsx|消息流渲染|辅助理解|

## 当前实现分析

chat.jsx 通过 useParams 获取会话 id，拉取历史消息，但未获取/渲染会话标题。

### 核心流程

1. 进入 chat 页面，获取会话 id。
2. 拉取历史消息（getSessionMessages）。
3. 未拉取会话详情/标题。
4. SubLayout 组件支持副标题（需确认）。
5. 目标：拉取会话详情，提取 topic，传递给 SubLayout 副标题。

### 关键代码片段

- chat.jsx 获取 id 并拉取消息：
  - src/pages/consultation/chat.jsx L1-L100
- getSessionMessages、chatSSE API：
  - src/api/consult.js
- SubLayout 组件副标题支持（props）：
  - src/layouts/SubLayout.jsx

## 架构洞察

- 建议在 chat.jsx 新增 useEffect 拉取会话详情，topic 状态管理。
- SubLayout 若无副标题 props，需补充。
- topic 获取失败时兜底“新对话”。

## 潜在风险和边缘情况

- 会话详情接口无 topic 字段或接口失败。
- 副标题 props 未被 SubLayout 支持。
- 多语言适配（如有）。

## 开放问题

- 会话详情 API 是否已存在？（如 getSessionDetail）
  - 回答：没有相关 API。目前可以根据 getSessions 获取会话列表，再根据会话 id 过滤出对应会话的 topic。
- topic 字段命名是否统一？
  - 回答：是的，字段命名为 topic。
- SubLayout 副标题渲染能力是否完善？
  - 回答：是的，SubLayout 已支持副标题渲染（ subtitle 属性）。

## 参考资料

- docs/“心青年”智能体平台-前端界面设计方案.md
- src/api/consult.js
- src/layouts/SubLayout.jsx


# 个人信息角色字段显示问题 实现计划

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-15 | v1.0 | 初始计划 | 基于 2026-01-15 研究报告与补充澄清 |

## 关联研究
[docs/tasks/12-个人信息角色字段显示问题/2026-01-15_个人信息角色字段显示问题_研究报告.md](docs/tasks/12-个人信息角色字段显示问题/2026-01-15_个人信息角色字段显示问题_研究报告.md)

## 功能概述

确保“个人信息”页面根据 user.roles 字段，自动渲染所有已知及未来扩展角色的 profile 字段，且 roles 与扩展字段不一致时给出用户提示。将 User 数据结构独立封装为标准文件，便于前后端及多端统一。

---

## Phase 1: PersonalInfo.jsx 渲染逻辑升级

### 目标

- 自动遍历 user.roles，渲染所有已知及未来扩展 profile 字段（如 `volunteer_profile`、`expert_profile`、`xxx_profile`）。
- roles 包含但 profile 缺失时，页面给出友好提示。
- 渲染顺序以 user.roles 数组顺序为准。

### 修改文件清单

|文件路径|修改类型|说明|
|---|---|---|
|src/pages/my/PersonalInfo.jsx|更新|渲染逻辑升级，提示处理|

### 具体变更

- 遍历 user.roles，动态拼接 `${role}_profile`，判断 user 是否有该字段。
- 有 profile 字段则渲染分组，无 profile 字段则渲染“暂无该角色详细信息”提示。
- 保持原有 SectionContainer 结构，支持多角色。

### 成功标准

- 自动验证：页面渲染所有 roles 对应 profile，roles 有 profile 缺失时有提示。
- 手动验证：切换不同角色用户，页面分组与提示均正确。

---


## Phase 2.1: User 类型定义与导出

### 目标

- 在 `src/types/User.js` 中定义并导出标准 User 类型（含 roles、各扩展 profile 字段）。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/types/User.js|新增|标准 User 类型定义|

### 具体变更
- User.js 导出 User 类型（JSDoc/TypeScript 注释，含 roles、扩展 profile）。

### 成功标准
- 自动验证：类型校验无误。
- 手动验证：类型定义完整，便于多端复用。

---

## Phase 2.2: UserContext 适配 User 类型

### 目标
- UserContext.jsx 引用 User 类型，拉取/存储 user 时按 User 类型校验。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/store/UserContext.jsx|更新|引用 User 类型，结构校验|

### 具体变更
- UserContext 拉取/存储 user 时按 User 类型校验。

### 成功标准
- 自动验证：类型校验无误。
- 手动验证：切换不同角色用户，数据结构无异常。

---

## Phase 2.3: auth.js Mock/接口结构统一

### 目标
- auth.js Mock/接口返回结构与 User 类型保持一致。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/api/auth.js|更新|Mock/接口返回结构与 User 类型一致|

### 具体变更
- auth.js Mock/接口返回结构与 User 类型保持一致。

### 成功标准
- 自动验证：接口/Mock 结构与 User 类型一致。
- 手动验证：切换不同角色用户，数据结构无异常。

---

## Phase 3: 角色映射与数据模型文档核查

### 目标

- roleMapping.js 支持未来角色扩展，映射自动适配。
- 数据模型文档补充 User 结构与扩展字段命名规范。

### 修改文件清单

|文件路径|修改类型|说明|
|---|---|---|
|src/utils/roleMapping.js|更新|支持自动映射新角色|
|docs/“心青年”智能体平台-数据模型与 API 设计.md|更新|补充 User 结构与扩展字段规范|

### 具体变更

- roleMapping.js 增加默认映射逻辑，未知角色可 fallback 为原文或“未知角色”。
- 数据模型文档补充 roles、扩展 profile 字段命名规范。

### 成功标准

- 自动验证：roleMapping 支持新角色，文档结构清晰。
- 手动验证：新增角色时无需前端硬编码即可渲染。

---

## Phase 4: 联调与边界场景验证

### 目标

- 验证多角色、缺失 profile、未知角色等边界场景。
- 确认所有提示与渲染逻辑符合预期。

### 修改文件清单

|文件路径|修改类型|说明|
|---|---|---|
|无|联调/测试| |

### 具体变更

- 构造多种 user 结构，手动/自动测试页面渲染与提示。

### 成功标准

- 自动验证：测试用例全部通过。
- 手动验证：所有边界场景页面表现正确。

---

## Commit message 模板

```
feat: 个人信息页角色扩展字段渲染升级，支持未来角色，profile 缺失时提示

- 动态渲染所有 roles 对应 profile 字段
- profile 缺失时页面友好提示
- User 类型独立封装，接口/Mock/上下文结构统一
- 角色映射与数据模型文档补充
```

## PR 描述要点

- 支持未来角色扩展，渲染逻辑自动适配
- roles/profile 不一致时页面有提示
- User 类型标准化，便于多端协作
- 详细测试多角色与边界场景


# 个人信息页弹窗功能优化 实现计划

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-15 | v1.0 | 初始计划 | 基于 2026-01-15 研究报告 |

## 关联研究
[docs/tasks/11-个人信息页弹窗功能优化/2026-01-15_个人信息页弹窗功能优化_研究报告.md](../../docs/tasks/11-个人信息页弹窗功能优化/2026-01-15_个人信息页弹窗功能优化_研究报告.md)

## 功能概述

对“个人信息”页面的字段编辑弹窗进行重构：
- 采用配置驱动的字段编辑组件（FieldEditor），提升可扩展性与维护性。
- 所有字段编辑统一为底部 Popup 弹窗，优化移动端体验。
- 支持轻量级字段校验与错误提示。
- 保持现有字段类型（input、segmented、switch）功能完整。

---

## Phase 1: 抽离字段编辑逻辑为 FieldEditor 组件

### 目标
将原有 renderEditInput 逻辑抽离为独立的 FieldEditor 组件，实现 type 到编辑控件的映射，支持配置驱动渲染。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/components/FieldEditor/index.jsx|新增|主编辑组件，实现 type 映射与渲染|
|src/components/FieldEditor/types.js|新增|字段类型、配置定义与映射表|
|src/components/FieldEditor/README.md|新增|组件用法说明|
|src/pages/my/PersonalInfo.jsx|修改|移除 renderEditInput，改为调用 FieldEditor|

### 具体变更
- 新建 FieldEditor 组件，支持 input、segmented、switch 类型。
- 组件 props 统一为：type、config、value、onChange、error。
- 维护 type 到具体编辑控件的映射表。
- 迁移/重构原有输入控件逻辑。

### 成功标准
- 自动验证：组件单元测试通过（如有）。
- 手动验证：可通过 FieldEditor 独立渲染不同类型字段，交互正常。

---

## Phase 2: 将 Modal 替换为 Popup，优化弹窗交互与样式

### 目标
将个人信息编辑弹窗由 antd-mobile Modal 替换为 Popup，优化移动端体验和样式。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/pages/my/PersonalInfo.jsx|修改|Modal 替换为 Popup，适配新交互|
|src/pages/my/PersonalInfo.css|修改/新增|优化弹窗与输入控件样式|

### 具体变更
- 使用 antd-mobile Popup 组件包裹 FieldEditor。
- 弹窗采用底部弹出，带圆角、全宽、padding。
- 标题栏含“取消”“保存”按钮，内容区样式美化。
- 关闭弹窗时重置编辑状态。

### 成功标准
- 自动验证：无 JS 报错，样式无异常。
- 手动验证：所有字段编辑均为底部弹窗，交互流畅，样式美观。

---

## Phase 3: 实现轻量级字段校验与错误提示

### 目标
为每个字段支持自定义校验函数，编辑时可实时/保存前校验并展示错误提示。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/components/FieldEditor/index.jsx|修改|支持 error、校验逻辑|
|src/pages/my/PersonalInfo.jsx|修改|集成校验逻辑，保存前校验|

### 具体变更
- 字段配置支持校验函数（如邮箱格式、必填等）。
- 校验未通过时，FieldEditor 展示红色错误提示。
- 保存按钮禁用或阻止提交。

### 成功标准
- 自动验证：校验逻辑单元测试通过（如有）。
- 手动验证：输入非法值时有错误提示，无法保存。

---

## Phase 4: 适配主页面调用，清理冗余代码，完善文档

### 目标
主页面完全适配新弹窗与编辑组件，移除冗余代码，补充组件文档。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|src/pages/my/PersonalInfo.jsx|修改|适配新组件，清理旧逻辑|
|src/components/FieldEditor/README.md|修改|补充用法与注意事项|

### 具体变更
- 主页面仅负责弹窗状态与数据流转，编辑逻辑全部交由 FieldEditor。
- 代码注释与文档补充。

### 成功标准
- 自动验证：页面无报错，CI 通过。
- 手动验证：所有字段编辑功能正常，代码结构清晰，文档完整。

---

## PR 提交模板

**commit message**：
feat: 个人信息页弹窗功能优化，重构为配置驱动+Popup

**PR 描述要点**：
- 抽离字段编辑组件 FieldEditor，实现配置驱动渲染
- 所有字段编辑弹窗统一为底部 Popup
- 支持轻量级字段校验与错误提示
- 适配主页面调用，优化样式与交互

